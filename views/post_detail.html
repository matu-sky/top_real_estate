<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= post.title %> | <%= board.name %></title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('partials/header.html') %>

    <main class="container">
        <section class="post-detail">
            <h2><%= post.title %></h2>
            <div class="post-meta">
                <span>작성자: <%= post.author %></span>
                <span>작성일: <%= new Date(post.created_at).toLocaleDateString('ko-KR') %></span>
            </div>
            <div class="post-content">
                <% if (post.attachment_path && post.attachment_path.match(/\.(jpeg|jpg|gif|png)$/i)) { %>
                    <img src="<%= post.attachment_path %>" alt="첨부 이미지" class="img-fluid mb-3">
                <% } %>
                <p><%- post.content.replace(/\n/g, '<br>') %></p>
                <% if (post.attachment_path) { %>
                    <div class="post-attachment">
                        <strong>첨부파일:</strong>
                        <a href="<%= post.attachment_path %>" target="_blank" download>
                            <% 
                                const fileNameWithTimestamp = post.attachment_path.split('/').pop();
                                const base64Part = fileNameWithTimestamp.substring(fileNameWithTimestamp.indexOf('_') + 1);
                                const decodedFileName = Buffer.from(base64Part, 'base64').toString('utf8');
                            %>
                            <%= decodedFileName %>
                        </a>
                    </div>
                <% } %>
            </div>
            <div class="post-actions">
                <a href="/board/<%= board.slug %>" class="btn-secondary">목록으로</a>
                <% if (user && user.loggedin) { %>
                    <a href="/board/<%= board.slug %>/<%= post.id %>/edit" class="btn-primary">수정</a>
                    <form action="/board/<%= board.slug %>/<%= post.id %>/delete" method="POST" style="display: inline;">
                        <button type="submit" class="btn-danger" onclick="return confirm('정말로 이 글을 삭제하시겠습니까?');">삭제</button>
                    </form>
                <% } %>
            </div>
        </section>
    </main>

    <%- include('partials/footer.html') %>
</body>
</html>