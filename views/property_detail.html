<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= property.title %> - 탑부동산</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('partials/header.html') %>

    <main class="container property-detail-container-v2">
        <div class="property-detail-header">
            <h1><%= property.title %></h1>
            <p class="property-address"><%= property.short_address %></p>
        </div>

        <!-- 1. 이미지 갤러리 -->
        <div class="property-gallery">
            <% if (property.image_path && property.image_path.length > 0) { %>
                <div class="main-image">
                    <img src="<%= property.image_path.split(',')[0] %>" alt="<%= property.title %>" id="main-property-image">
                </div>
                <div class="thumbnail-images">
                    <% property.image_path.split(',').forEach(function(img) { %>
                        <img src="<%= img %>" alt="<%= property.title %>" class="thumbnail">
                    <% }); %>
                </div>
            <% } else { %>
                <div class="main-image">
                    <img src="/images/default_property.jpg" alt="기본 이미지" id="main-property-image">
                </div>
            <% } %>
        </div>

        <!-- 2. 통합 매물 정보 -->
        <div class="property-info-section">
            <h2>매물 상세 정보</h2>
            <table class="property-info-table-unified">
                <tr>
                    <th>카테고리</th>
                    <td><%= property.category %></td>
                    <th>가격</th>
                    <td class="price"><%= property.price %></td>
                </tr>
                <tr>
                    <th>거래유형</th>
                    <td><%= property.transaction_type %></td>
                    <th>면적(공급)</th>
                    <td><%= property.area %> m²</td>
                </tr>
                <tr>
                    <% if (property.exclusive_area) { %>
                        <th>면적(전용)</th>
                        <td><%= property.exclusive_area %> m²</td>
                    <% } else { %>
                        <th></th><td></td>
                    <% } %>
                    <th>층/총층</th>
                    <td><%= property.floor %> / <%= property.total_floors %></td>
                </tr>
                <tr>
                    <th>방향</th>
                    <td><%= property.direction %> (<%= property.direction_standard %> 기준)</td>
                    <th>주차</th>
                    <td><%= property.parking ? property.parking + ' 대' : '정보 없음' %></td>
                </tr>
                <tr>
                    <th>관리비</th>
                    <td colspan="3"><%= property.maintenance_fee ? property.maintenance_fee + ' 원' : '정보 없음' %></td>
                </tr>
                 <% if (property.maintenance_fee_details) { %>
                <tr>
                    <th>관리비 상세</th>
                    <td colspan="3"><%= property.maintenance_fee_details %></td>
                </tr>
                <% } %>
                <% if (property.purpose) { %>
                <tr>
                    <th>용도</th>
                    <td><%= property.purpose %></td>
                    <th>사용승인일</th>
                    <td><%= property.approval_date %></td>
                </tr>
                <% } %>
                <% if (property.power_supply || property.hoist) { %>
                <tr>
                    <th>사용전력</th>
                    <td><%= property.power_supply %></td>
                    <th>호이스트</th>
                    <td><%= property.hoist %></td>
                </tr>
                <% } %>
                <% if (property.ceiling_height || property.access_road_condition) { %>
                <tr>
                    <th>층고</th>
                    <td><%= property.ceiling_height %> m</td>
                    <th>진입로 사정</th>
                    <td><%= property.access_road_condition %></td>
                </tr>
                <% } %>
                <% if (property.permitted_business_types) { %>
                <tr>
                    <th>가능 업종</th>
                    <td colspan="3"><%= property.permitted_business_types %></td>
                </tr>
                <% } %>
                <tr>
                    <th>입주가능일</th>
                    <td colspan="3"><%= property.move_in_date %></td>
                </tr>
                <tr>
                    <th>상세 설명</th>
                    <td colspan="3" class="description-cell">
                        <%- property.description ? property.description.replace(/\n/g, '<br>') : '' %>
                    </td>
                </tr>
            </table>
        </div>

        <!-- 3. 유튜브 영상 -->
        <% if (property.youtube_url) { %>
            <div class="property-video">
                <h2>소개 영상</h2>
                <div class="youtube-wrapper">
                    <iframe src="https://www.youtube.com/embed/<%= property.youtube_url.split('v=')[1] %>" frameborder="0" allowfullscreen></iframe>
                </div>
            </div>
        <% } %>

        <!-- 4. 같은 카테고리의 다른 매물 -->
        <% if (relatedProperties && relatedProperties.length > 0) { %>
            <div class="related-properties-section">
                <h2><%= property.category %> 다른 매물</h2>
                <div class="related-properties-list">
                    <% relatedProperties.forEach(function(p) { %>
                        <a href="/property/<%= p.id %>" class="related-property-item">
                            <div class="related-property-image">
                                <img src="<%= p.image_path ? p.image_path.split(',')[0] : '/images/default_property.jpg' %>" alt="<%= p.title %>">
                            </div>
                            <div class="related-property-info">
                                <h3><%= p.title %></h3>
                                <p class="price"><%= p.price %></p>
                                <p class="address"><%= p.address ? p.address.split(' ').slice(0, 3).join(' ') : '' %></p>
                            </div>
                        </a>
                    <% }); %>
                </div>

                <% if (totalPages > 1) { %>
                    <div class="pagination">
                        <% if (currentPage > 1) { %>
                            <a href="?page=<%= currentPage - 1 %>" class="page-link">이전</a>
                        <% } %>

                        <% for (let i = 1; i <= totalPages; i++) { %>
                            <a href="?page=<%= i %>" class="page-link <%= i === currentPage ? 'active' : '' %>"><%= i %></a>
                        <% } %>

                        <% if (currentPage < totalPages) { %>
                            <a href="?page=<%= currentPage + 1 %>" class="page-link">다음</a>
                        <% } %>
                    </div>
                <% } %>
            </div>
        <% } %>
    </main>

    <%- include('partials/footer.html') %>
    <script src="/js/main.js"></script>
</body>
</html>