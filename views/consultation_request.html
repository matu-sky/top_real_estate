<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상담문의 | 탑 부동산</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/admin_style.css"> <!-- 폼 스타일 재사용 -->
    <style>
        .form-container {
            max-width: 800px;
            margin: 60px auto;
            padding: 40px;
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 12px;
        }
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 10px;
        }
        .checkbox-group label {
            font-weight: normal;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        .email-field-group, .phone-field-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .email-field-group input[type="text"],
        .email-field-group select,
        .phone-field-group input[type="text"] {
            flex: 1;
        }
        .phone-field-group input[type="text"] {
            text-align: center;
        }

        /* 모바일 화면 대응 */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .email-field-group, .phone-field-group {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <%- include('partials/header.html') %>

    <main class="container">
        <div class="form-container">
            <div class="section-title" style="margin-bottom: 30px;">
                <h2>상담문의</h2>
                <p style="font-size: 0.9rem; color: #6c757d;">아래 폼을 작성해주시면, 전문 담당자가 신속하게 검토 후 연락드리겠습니다.</p>
            </div>

            <form id="consultationForm" action="#" method="POST" onsubmit="prepareFormSubmit()">
                <div class="form-group">
                    <label>매물 구분 *</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="prop_residential" name="property_type" value="주거용">
                        <label for="prop_residential">주거용</label>
                        <input type="checkbox" id="prop_commercial" name="property_type" value="상업용">
                        <label for="prop_commercial">상업용</label>
                        <input type="checkbox" id="prop_factory" name="property_type" value="공장/지산">
                        <label for="prop_factory">공장/지산</label>
                        <input type="checkbox" id="prop_other" name="property_type" value="기타">
                        <label for="prop_other">기타</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="inquiry_type">문의 유형 *</label>
                    <select id="inquiry_type" name="inquiry_type" required>
                        <option value="">선택하세요</option>
                        <option value="매도/임대">매도/임대</option>
                        <option value="매수/임차">매수/임차</option>
                        <option value="양도양수">양도양수</option>
                        <option value="기타일반">기타일반</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="title">제목 *</label>
                    <input type="text" id="title" name="title" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="name">이름 *</label>
                        <input type="text" id="name" name="name" required>
                    </div>
    
                    <div class="form-group">
                        <label for="phone1">전화번호 *</label>
                        <div class="phone-field-group">
                            <input type="text" id="phone1" maxlength="3" required>
                            <span>-</span>
                            <input type="text" id="phone2" maxlength="4" required>
                            <span>-</span>
                            <input type="text" id="phone3" maxlength="4" required>
                        </div>
                        <input type="hidden" id="phone" name="phone">
                    </div>
    
                    <div class="form-group">
                        <label for="email_local">이메일</label>
                        <div class="email-field-group">
                            <input type="text" id="email_local" placeholder="아이디">
                            <span>@</span>
                            <select id="email_domain_select" onchange="updateEmailDomain()">
                                <option value="naver.com">naver.com</option>
                                <option value="gmail.com">gmail.com</option>
                                <option value="hanmail.net">hanmail.net</option>
                                <option value="daum.net">daum.net</option>
                                <option value="nate.com">nate.com</option>
                                <option value="custom">직접 입력</option>
                            </select>
                        </div>
                        <input type="text" id="email_domain_custom" style="display: none; margin-top: 8px;" placeholder="도메인 입력">
                        <input type="hidden" id="email" name="email">
                    </div>
                </div>

                <div class="form-group">
                    <label for="message">상세 문의 내용</label>
                    <textarea id="message" name="message" rows="8"></textarea>
                </div>

                <div class="form-group">
                    <input type="checkbox" id="privacy_policy" name="privacy_policy" required>
                    <label for="privacy_policy">개인정보 수집 및 이용에 동의합니다. *</label>
                </div>

                <button type="submit" class="btn-primary" style="width: 100%; padding: 15px;">문의 접수하기</button>
            </form>
        </div>
    </main>

    <%- include('partials/footer.html') %>

    <script>
        function updateEmailDomain() {
            const select = document.getElementById('email_domain_select');
            const customInput = document.getElementById('email_domain_custom');
            if (select.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        function assembleEmail() {
            const localPart = document.getElementById('email_local').value;
            const domainSelect = document.getElementById('email_domain_select');
            const customDomain = document.getElementById('email_domain_custom').value;
            const finalEmailInput = document.getElementById('email');

            if (!localPart) {
                finalEmailInput.value = '';
                return;
            }

            let domainPart = '';
            if (domainSelect.value === 'custom') {
                domainPart = customDomain;
            } else {
                domainPart = domainSelect.value;
            }

            if (localPart && domainPart) {
                finalEmailInput.value = `${localPart}@${domainPart}`;
            } else {
                finalEmailInput.value = '';
            }
        }

        function assemblePhone() {
            const phone1 = document.getElementById('phone1').value;
            const phone2 = document.getElementById('phone2').value;
            const phone3 = document.getElementById('phone3').value;
            const finalPhoneInput = document.getElementById('phone');

            if (phone1 && phone2 && phone3) {
                finalPhoneInput.value = `${phone1}-${phone2}-${phone3}`;
            } else {
                finalPhoneInput.value = '';
            }
        }

        function prepareFormSubmit() {
            assembleEmail();
            assemblePhone();
            // 여기에 reCAPTCHA 로직 등을 추가할 수 있습니다.
            return true; // 실제 폼 제출 계속
        }

        document.addEventListener('DOMContentLoaded', function() {
            // URL 파라미터로 문의 유형 자동 선택
            const urlParams = new URLSearchParams(window.location.search);
            const inquiryType = urlParams.get('type');
            if (inquiryType) {
                const selectElement = document.getElementById('inquiry_type');
                selectElement.value = inquiryType;
            }

            // 전화번호 필드 자동 포커스 이동
            const phone1 = document.getElementById('phone1');
            const phone2 = document.getElementById('phone2');
            const phone3 = document.getElementById('phone3');

            phone1.addEventListener('keyup', function() {
                if (this.value.length === 3) {
                    phone2.focus();
                }
            });

            phone2.addEventListener('keyup', function() {
                if (this.value.length === 4) {
                    phone3.focus();
                }
            });
        });
    </script>
</body>
</html>